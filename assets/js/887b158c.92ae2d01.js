"use strict";(self.webpackChunkminima_docs=self.webpackChunkminima_docs||[]).push([[745],{2197:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>c,frontMatter:()=>s,metadata:()=>i,toc:()=>d});var a=n(5893),r=n(1151);const s={sidebar_position:13},o="The Vault",i={id:"buildonminima/txntutorial/layer1/thevault",title:"The Vault",description:"Now we will try a far more interesting script than we have previously.",source:"@site/docs/buildonminima/txntutorial/layer1/thevault.md",sourceDirName:"buildonminima/txntutorial/layer1",slug:"/buildonminima/txntutorial/layer1/thevault",permalink:"/docs/buildonminima/txntutorial/layer1/thevault",draft:!1,unlisted:!1,editUrl:"https://github.com/minima-global/minidocs/docs/buildonminima/txntutorial/layer1/thevault.md",tags:[],version:"current",sidebarPosition:13,frontMatter:{sidebar_position:13},sidebar:"tutorialSidebar",previous:{title:"MAST Contracts",permalink:"/docs/buildonminima/txntutorial/layer1/mastcontract"},next:{title:"Coin Flip",permalink:"/docs/buildonminima/txntutorial/layer1/coinflip"}},l={},d=[];function h(e){const t={code:"code",h1:"h1",p:"p",pre:"pre",...(0,r.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.h1,{id:"the-vault",children:"The Vault"}),"\n",(0,a.jsx)(t.p,{children:"Now we will try a far more interesting script than we have previously."}),"\n",(0,a.jsx)(t.p,{children:"It is similar in principle to the multisig we played with earlier that had a cold and hot key for added security. But instead of trusting someone to be the co-signer, you use a smart contract to ensure funds are sent to an intermediary address before moving on.."}),"\n",(0,a.jsx)(t.p,{children:"Vault wallets are special. They use 'covenants' to ensure that funds are ALWAYS sent to a safe house first."}),"\n",(0,a.jsx)(t.p,{children:"Vaults use 2 sets of keys. One that is HOT. These are kept online and are used to send funds from the vault to the safe house and eventually beyond. Another set is COLD. These are NEVER kept online and are only used in the event of a hack - or error in recipient. The HOT keys can be hacked.. and it's really no big deal."}),"\n",(0,a.jsxs)(t.p,{children:["What this means is that when you wish to send funds they MUST first be sent to a special address for a period of time - the Safe House. This is enforced by the smart contract. Even the owner of the vault must do this, and so therefore even the hacker who has pinched the keys. ",(0,a.jsx)("br",{}),"\r\nOnce the funds are at the safe house, you must wait a certain amount of time until you can send them to ONLY the pre-specified address. If they were sent by a hacker - you the owner can claim them back, within a certain amount of time, with your COLD key."]}),"\n",(0,a.jsx)(t.p,{children:"Hot wallet convenience with cold wallet security and all it takes is a little delay. An exchange, for instance, can keep large amounts online and available to send this way. Simple (yet secure)."}),"\n",(0,a.jsx)(t.p,{children:"Here's the script for the Vault:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"/* You need 2 keys */\r\nLET pkcold = 0xCOLD_KEY LET pkhot = 0xHOT_KEY\r\n\r\n/* COLD key has root access*/\r\nIF SIGNEDBY ( pkcold ) THEN RETURN TRUE ENDIF\r\n\r\n/* The Amount and Recipient are specified in the State */ \r\nLET amt = STATE ( 20 ) LET recip = STATE ( 21 )\r\n\r\n/* Now generate the Safe House Address */\r\nLET safehouse = \r\n    [ LET pkcold = 0xCOLD_KEY LET pkhot = 0xHOT_KEY\r\n        IF SIGNEDBY ( pkcold ) THEN RETURN TRUE ENDIF\r\n        IF SIGNEDBY ( pkhot ) THEN IF @COINAGE GT 20 THEN\r\n            RETURN VERIFYOUT ( @INPUT PREVSTATE ( 21 ) @AMOUNT @TOKENID TRUE ) \r\n        ENDIF\r\nENDIF ]\r\n\r\n/* Make sure The Safe House Address is the opposite output */\r\nASSERT VERIFYOUT ( @INPUT ADDRESS(safehouse) amt @TOKENID TRUE )\r\n\r\n/* Send the change back to the Vault */ \r\nLET chg = @AMOUNT - amt\r\nIF chg GT 0 THEN\r\n    ASSERT VERIFYOUT ( INC(@INPUT) @ADDRESS ( @AMOUNT - amt ) @TOKENID TRUE ) \r\nENDIF\r\n\r\n/* Make sure is signed by the HOT key */ \r\nRETURN SIGNEDBY ( pkhot )\n"})}),"\n",(0,a.jsx)(t.p,{children:"Here is the expanded safe house script - that is generated by the vault."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"/* Same Keys as Vault */ \r\nLET pkcold = COLD_KEY LET pkhot = HOT_KEY\r\n\r\n/* COLD key again has root access */\r\nIF SIGNEDBY ( pkcold ) THEN RETURN TRUE ENDIF\r\n\r\n/* ONLY spend after 20 blocks and ONLY to the pre-specified address for the whole amount */ IF SIGNEDBY ( pkhot ) THEN\r\nIF @COINAGE GT 20 THEN\r\nRETURN VERIFYOUT ( @INPUT PREVSTATE ( 21 ) @AMOUNT @TOKENID TRUE )\r\nENDIF ENDIF\n"})}),"\n",(0,a.jsx)(t.p,{children:"Quite a lot going on there."}),"\n",(0,a.jsx)(t.p,{children:"Basically the vault itself creates the address to send the funds to. You can see when someone spends funds from the vault. If it wasn't you, you have till the timeout expires to get the cold key and rescue the funds."})]})}function c(e={}){const{wrapper:t}={...(0,r.a)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},1151:(e,t,n)=>{n.d(t,{Z:()=>i,a:()=>o});var a=n(7294);const r={},s=a.createContext(r);function o(e){const t=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),a.createElement(s.Provider,{value:t},e.children)}}}]);