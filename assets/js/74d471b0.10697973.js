"use strict";(self.webpackChunkminima_docs=self.webpackChunkminima_docs||[]).push([[3821],{8285:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>h,contentTitle:()=>r,default:()=>d,frontMatter:()=>o,metadata:()=>a,toc:()=>l});var i=t(5893),s=t(1151);const o={sidebar_position:6},r="Mining and Consensus",a={id:"learn/minima/miningconsensus",title:"Mining and Consensus",description:"Magic Numbers",source:"@site/docs/learn/minima/miningconsensus.md",sourceDirName:"learn/minima",slug:"/learn/minima/miningconsensus",permalink:"/docs/learn/minima/miningconsensus",draft:!1,unlisted:!1,editUrl:"https://github.com/minima-global/minidocs/docs/learn/minima/miningconsensus.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"The Blockchain",permalink:"/docs/learn/minima/theblockchain"},next:{title:"Coloured Coins",permalink:"/docs/learn/minima/colouredcoins"}},h={},l=[{value:"Magic Numbers",id:"magic-numbers",level:2},{value:"Difficulty",id:"difficulty",level:2},{value:"Transaction (TxPoW) Difficulty",id:"transaction-txpow-difficulty",level:2},{value:"Block Difficulty",id:"block-difficulty",level:2},{value:"Superblock Difficulty",id:"superblock-difficulty",level:2},{value:"Block Weight",id:"block-weight",level:2},{value:"Constructing TxPoW Units",id:"constructing-txpow-units",level:2},{value:"Mining TxPoW units",id:"mining-txpow-units",level:2},{value:"Validating TxPoW units",id:"validating-txpow-units",level:2},{value:"Processing TxPoW &amp; Assembling the Chain",id:"processing-txpow--assembling-the-chain",level:2},{value:"Selecting the main chain (GHOST)",id:"selecting-the-main-chain-ghost",level:2}];function c(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"mining-and-consensus",children:"Mining and Consensus"}),"\n",(0,i.jsx)(n.h2,{id:"magic-numbers",children:"Magic Numbers"}),"\n",(0,i.jsx)(n.p,{children:"The Magic numbers provide a mechanism for future-proofing the network. As technology improves over time, increasing the storage and processing capacity on mobile devices, the Magic numbers allow Minima to adapt or grow simultaneously."}),"\n",(0,i.jsxs)(n.p,{children:["There are two sets of four variables that define the network, for each variable there is the ",(0,i.jsx)(n.strong,{children:"Current"})," network value and the user\u2019s ",(0,i.jsx)(n.strong,{children:"Desired"})," value. The Current value dictates the network at that point in time, the value that the whole network is currently working to. Desired values can be specified by users to reflect the capability of their node.\r\nNote: Desired values must take a value that is at least half of the corresponding Current value, and not more than double the corresponding Current value."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"The Current Magic numbers are recalculated every block"})," by taking a heavily weighted average of 16383:1 in favour of the Current network value over the node\u2019s Desired value. Provided the entire network agrees on a new desired value, over a period of approximately 50 days, the Current Magic value will converge to the Desired value."]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{style:{textAlign:"left"},children:"Magic Number"}),(0,i.jsx)(n.th,{style:{textAlign:"left"},children:"Description"}),(0,i.jsx)(n.th,{style:{textAlign:"left"},children:"Default Value"}),(0,i.jsx)(n.th,{style:{textAlign:"left"},children:"Type"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"left"},children:(0,i.jsx)(n.strong,{children:"CurrentMaxTxPoWSize"})}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"The maximum size of a TxPoW unit in bytes."}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"The default and minimum TxPoW size is 64KB"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"MiniNumber"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"left"},children:(0,i.jsx)(n.strong,{children:"CurrentMaxKISSVMOps"})}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"The maximum number of KISS VM operations in a TxPoW (script complexity)"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"The default and minimum is 1024"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"MiniNumber"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"left"},children:(0,i.jsx)(n.strong,{children:"CurrentMaxTxnPerBlock"})}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"The maximum number of transactions per block"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"The default and minimum transactions per TxPoW unit is 256"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"MiniNumber"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"left"},children:(0,i.jsx)(n.strong,{children:"CurrentMinTxPoWWork"})}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"The target value for the hash of a TxPoW header, that must be met before for a TxPoW unit to be sent across the network"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"The minimum is equivalent to 1 million hashes/second"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"MiniNumber"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"difficulty",children:"Difficulty"}),"\n",(0,i.jsxs)(n.p,{children:["Difficulty is a dynamic value which determines how hard it is to mine a TxPoW unit. ",(0,i.jsx)("br",{}),"\r\nThe difficulty value is used to calculate a target value which the hash value of the TxPoW header (the TxPoW ID) needs to be less than."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-math",children:"Target Value = Max Value/Difficulty Value\r\n\r\nWhere \r\nMax value (represented in Hex) = FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF\r\n \r\nMax value (represented in Decimal) = 1.15792089237316E+77\n"})}),"\n",(0,i.jsx)(n.p,{children:"In Minima, there are multiple difficulty levels:"}),"\n",(0,i.jsx)(n.p,{children:"Diagram: Basic representation of the different difficulty levels, where transaction target is the easiest to achieve (not to scale)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{alt:"Mining and Consensus",src:t(5278).Z+"#gh-light-mode-only",width:"1169",height:"520"}),(0,i.jsx)(n.img,{alt:"Mining and Consensus",src:t(3884).Z+"#gh-dark-mode-only",width:"1169",height:"520"})]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsx)(n.p,{children:"The higher the difficulty, the lower the target value, the harder it is to achieve."})}),"\n",(0,i.jsx)(n.h2,{id:"transaction-txpow-difficulty",children:"Transaction (TxPoW) Difficulty"}),"\n",(0,i.jsx)(n.p,{children:"The default and minimum difficulty value is 1 million, meaning that a device with a hash rate of 1m hashes/second will need to perform 1 second of \u2018work\u2019 before the target is met and their TxPoW can be propagated across the network, entering the mempool of unconfirmed transactions."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-math",children:"The default and easiest TxPoW Target = Max Value/1,000,000\r\n\r\nTarget represented in Hex = 0x10C6F7A0B5ED853E638E9803F452E932EB00EAD38965A800000000000000\r\n\r\nTarget represented in Decimal = 1.15792089237316E+71\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This is the magic number ",(0,i.jsx)(n.strong,{children:"CurrentMinTxPoWWork."})," ",(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(n.p,{children:"The actual transaction difficulty for a node considers the achievable hash rate of the node and is equal to the higher value of 1 million or the device\u2019s hash rate in hashes/second, so that each device performs roughly 1 second of \u2018work\u2019 to \u2018mine\u2019 their transaction (TxPoW unit)."}),"\n",(0,i.jsx)(n.h2,{id:"block-difficulty",children:"Block Difficulty"}),"\n",(0,i.jsx)(n.p,{children:"The purpose of the block difficulty level is to regulate the frequency at which blocks are found on the network ensuring block intervals remain as close to 50 seconds as possible. TxPoW units only require the minimum amount of work before they are sent across the network, however these TxPoW units can become blocks and get added to the chain if, by chance, the TxPoW ID hash is also less than the network block difficulty target."}),"\n",(0,i.jsx)(n.p,{children:"The block target is much lower (harder) than the transaction target, and fluctuates with the number of nodes on the network and their hash rate, so that 50 block intervals are maintained."}),"\n",(0,i.jsx)(n.p,{children:"If block times deviate from 50 second intervals, the difficulty will be adjusted proportionally, by a maximum of 10% up or down."}),"\n",(0,i.jsx)(n.p,{children:"The block difficulty will always be at least as hard as the transaction difficulty."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Adjusting the block difficulty:"}),(0,i.jsx)("br",{})]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example 1: Block times too slow"}),(0,i.jsx)("br",{}),"\r\nIf the time interval between blocks slows down to 1 block every 54 seconds, the current block difficulty will be decreased by a factor of 50/54 = 0.926. ",(0,i.jsx)("br",{}),"\r\n",(0,i.jsx)(n.em,{children:"This lower difficulty increases the block target value, making it easier for nodes to achieve and acting to speed up the interval between blocks."})]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example 2: Block times too fast"})," ",(0,i.jsx)("br",{}),"\r\nIf the time interval between blocks speeds up to 1 block every 45 seconds, the current speed ratio (required block time/actual chain speed) is 50/44 = 1.25, however since this is over 10%, the block difficulty will only be increased by the maximum 1.1. ",(0,i.jsx)("br",{}),"\r\n",(0,i.jsx)(n.em,{children:"This higher difficulty decreases the block target value, making it harder for nodes to achieve and acting to slow down the interval between blocks."})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Once the transaction (not block) difficulty target has been met, the mining process finishes.\r\nIf the block difficulty target has by chance also been achieved, then the TxPoW unit will become a block and be added to the main chain."}),"\n",(0,i.jsx)(n.h2,{id:"superblock-difficulty",children:"Superblock Difficulty"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"/docs/learn/minima/theblockchain#the-cascading-chain",children:"(see Cascading Chain)"})}),"\n",(0,i.jsx)(n.h2,{id:"block-weight",children:"Block Weight"}),"\n",(0,i.jsx)(n.p,{children:"A block\u2019s base weight is equal to the difficulty value that was required for it to become a block. This also represents the average number of hashes that would be required to meet this block target value."}),"\n",(0,i.jsxs)(n.p,{children:["For a specific block: ",(0,i.jsx)("br",{}),"\r\n",(0,i.jsx)(n.code,{children:"Base Weight = Max Target Value/Block Target Value"})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:"Note that this is not the actual weight, which would be the actual number of hashes it took to find a value less than the target."})}),"\n",(0,i.jsxs)(n.p,{children:["If the actual weight, by chance, exceeds its base weight by at least a factor of 2, the block will be considered a Super Block ",(0,i.jsx)(n.a,{href:"/docs/learn/minima/theblockchain#the-cascading-chain",children:"(see Cascading Chain)"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"constructing-txpow-units",children:"Constructing TxPoW Units"}),"\n",(0,i.jsx)(n.p,{children:"TxPoW units are created after a transaction and its witness has been created. Once created, the TxPoW will be \u2018mined\u2019 and propagated across the network."}),"\n",(0,i.jsxs)(n.p,{children:["The following Terminal commands will result in creation of a TxPoW unit:",(0,i.jsx)("br",{}),"\r\n",(0,i.jsx)(n.strong,{children:"send"})," - send a transaction ",(0,i.jsx)("br",{}),"\r\n",(0,i.jsx)(n.strong,{children:"tokencreate"})," - create a custom token",(0,i.jsx)("br",{}),"\r\n",(0,i.jsx)(n.strong,{children:"txnpost"})," - posting a manually constructed transaction",(0,i.jsx)("br",{})]}),"\n",(0,i.jsxs)(n.p,{children:["A TxPoW unit is constructed as follows: ",(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"1. Create the TxPoW"})}),"\n",(0,i.jsx)(n.p,{children:"Set details"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Block height (if this TxPoW becomes a block)"}),"\n",(0,i.jsx)(n.li,{children:"Timemilli (the node\u2019s current time)"}),"\n",(0,i.jsx)(n.li,{children:"Main transaction & Witness (the transaction the user is sending)"}),"\n",(0,i.jsx)(n.li,{children:"Burn transaction & Witness"}),"\n",(0,i.jsx)(n.li,{children:"Calculate & set the magic numbers"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"2. Set the Cascade Super Parents"})}),"\n",(0,i.jsxs)(n.p,{children:["If the current tip block is Super Level i, this TxPoW will have:  ",(0,i.jsx)("br",{}),"\r\n",(0,i.jsx)(n.strong,{children:"Super Parents for Levels 0-i:"})," Current tip block ",(0,i.jsx)("br",{}),"\r\n",(0,i.jsx)(n.strong,{children:"Super Parents for Levels i-31:"})," same Super Parents as the current tip"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"3. Set the Transaction difficulty"})}),"\n",(0,i.jsxs)(n.p,{children:["The Hex value that the hash of the TxPoW must be less than to be valid, is set based on the hash rate of the node. It must be no easier than the Magic number ",(0,i.jsx)(n.strong,{children:"CurrentMinTxPoWWork."})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Minimum TxPoW hash = Max Value / user\u2019s hash rate\r\n\r\nIf\r\n Minimum TxPoW hash > CurrentMinTxPoWWork i.e. if the Minimum TxPoW hash is easier than CurrentMinTxPoWWork\r\nthen\r\n Minimum TxPoW hash = CurrentMinTxPoWWork\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"4. Calculate Chain Speed and Block Difficulty"})}),"\n",(0,i.jsx)(n.p,{children:"Using the latest 256 blocks in the main chain, the average time and block difficulty for each block is calculated and the block difficulty target is adjusted proportionally by a maximum of 10% up or down."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"Initial Start Position = tip block, Initial End Position = tip - 256 "})}),"\n",(0,i.jsx)(n.p,{children:"The two blocks with the median time from the 32 blocks prior to the initial start and initial end positions are determined. Those blocks become the final start and end positions to calculate the current Chain Speed and Block Difficulty.\r\nUsing the median smooths out any anomalies in the system time of nodes on the network."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Chain speed (secs) = Avg time interval per block between the final start and end position \r\n\r\nSpeed Ratio = Required block speed (50 secs)/Chain speed  \r\n\r\nAverage block difficulty = Avg difficulty for blocks between the start and end position \n"})}),"\n",(0,i.jsx)(n.p,{children:"Then,"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"New block difficulty = Avg block difficulty * Speed Ratio\r\n(if 0.9 <= Speed Ratio <= 1.1)\r\n\r\nor\r\nNew block difficulty = Avg block difficulty * 0.9\r\n(if Speed Ratio < 0.9)\r\n\r\nor\r\nNew block difficulty = Avg block difficulty * 1.1\r\n(if Speed Ratio > 1.1)\r\n\r\nor\r\nNew block difficulty = CurrentMinTxPoWWork \r\n(if Avg block difficulty * Speed Ratio < CurrentMinTxPoWWork and 0.9 <= Speed Ratio <= 1.1)\n"})}),"\n",(0,i.jsxs)(n.p,{children:["i.e. the Magic number ",(0,i.jsx)(n.strong,{children:"CurrentMinTxPoWWork"})," is used as a lower bound for the block difficulty"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"5. Order Mempool Transactions"})}),"\n",(0,i.jsx)(n.p,{children:"Sort the unconfirmed mempool TxPoW units by the amount they burn."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"6. Check Mempool Transactions"})}),"\n",(0,i.jsx)(n.p,{children:"Cycle through the mempool transactions checking the following:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Coins are not already added to this TxPoW"}),"\n",(0,i.jsxs)(n.li,{children:["Transaction size is less than or equal to the magic number ",(0,i.jsx)(n.strong,{children:"CurrentMaxTxPoWSize"})]}),"\n",(0,i.jsxs)(n.li,{children:["Transaction difficulty must be harder than or equal to the magic number ",(0,i.jsx)(n.strong,{children:"CurrentMinTxPoWWork"})]}),"\n",(0,i.jsx)(n.li,{children:"MMR Proofs are valid"}),"\n",(0,i.jsx)(n.li,{children:"Script Proofs are valid"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"7. Add valid Mempool TxPoWs"})}),"\n",(0,i.jsxs)(n.p,{children:["Create a list of valid mempool transactions, including the maximum allowed by the magic number ",(0,i.jsx)(n.strong,{children:"CurrentMaxTxnPerBlock"}),". This list is added to the body of the TxPoW unit. Invalid TxPoW are removed from the mempool. ",(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["Only the TxPoW IDs of mempool transactions are added to this list. ",(0,i.jsx)("br",{})]})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"8. Calculate hashes for main and burn transactions"})}),"\n",(0,i.jsx)(n.p,{children:"Calculate the hash of the main transaction and the burn transaction, add these to the TxPoW body.\r\nThese are required for creating the Coin IDs of the transaction outputs and the MMR."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"9. Construct the MMR"})}),"\n",(0,i.jsx)(n.p,{children:"Construct an updated MMR set with proofs for the newly created coins (UTxOs).\r\nCalculate the new MMR root hash and the root value."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"10. Add the MMR Root data"})}),"\n",(0,i.jsx)(n.p,{children:"Add the MMR root hash and value (sum of all coins in the network) to the TxPoW header."}),"\n",(0,i.jsx)(n.p,{children:"**The TxPoW generation process is complete and is ready to be 'mined' before being sent on to peer nodes for propagation across the network. **"}),"\n",(0,i.jsx)(n.h2,{id:"mining-txpow-units",children:"Mining TxPoW units"}),"\n",(0,i.jsxs)(n.p,{children:["Once a new TxPoW unit has been created, it must be \u2018mined\u2019 before a node can send it on to its peers.",(0,i.jsx)("br",{})]}),"\n",(0,i.jsxs)(n.p,{children:["Mining is the process of repeatedly hashing the TxPoW header, each time with a different number (known as the nonce value) set in the header. By changing the nonce each time, the header data changes, resulting in a different hash. ",(0,i.jsx)("br",{}),"\r\nThis process is repeated until the resulting hash is less than the transaction difficulty target. Once this is achieved, the required difficulty level has been met and the TxPoW has enough \u2018Proof of Work\u2019 to be propagated to other nodes in the network."]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["A node does not consider the block difficulty target during the mining process. ",(0,i.jsx)("br",{}),"\r\nOnly after a TxPoW has been mined, is it evaluated to see if it will become a block - if the TxPoW ID hash is also, by chance, lower than the block difficulty target."]})}),"\n",(0,i.jsx)(n.p,{children:"A TxPoW unit is \u2018mined\u2019 as follows:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"1. Calculate TxPoW body hash"})}),"\n",(0,i.jsx)(n.p,{children:"Hash the TxPoW body and set in it the TxPoW header"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"2. Set the initial nonce value"})}),"\n",(0,i.jsx)(n.p,{children:"Set the start nonce value in the TxPoW header"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"3. Hash - Check - Set"})}),"\n",(0,i.jsx)(n.p,{children:"The TxPoW header is hashed, if it does not satisfy the transaction difficulty, the nonce is incremented by 1 and the process repeats."}),"\n",(0,i.jsx)(n.p,{children:"Once the hashed TxPoW header satisfies the transaction difficulty, the final nonce value is set in the TxPoW header"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"4. Calculate the TxPoW ID & Size"})}),"\n",(0,i.jsx)(n.p,{children:"The hash of the TxPoW header is the TxPoW ID.\r\nIf it also meets the block difficulty target, its Block weight and Super Level are also calculated."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Once the mining process has ended, the node will continue to validate, process and send the TxPoW ID across the network."})}),"\n",(0,i.jsx)(n.h2,{id:"validating-txpow-units",children:"Validating TxPoW units"}),"\n",(0,i.jsx)(n.p,{children:"Once a user has successfully mined a TxPoW unit or when they have received a TxPoW unit from a peer, it must be validated before propagating to peers."}),"\n",(0,i.jsxs)(n.p,{children:["The potential outcomes from this check are:",(0,i.jsx)("br",{}),"\r\n",(0,i.jsx)(n.strong,{children:"Outcome 1:"})," The TxPoW is invalid - disconnect from the client who sent it and discard the TxPoW.",(0,i.jsx)("br",{}),"\r\n",(0,i.jsx)(n.strong,{children:"Outcome 2:"})," The TxPoW is not fully valid - some check(s) did not pass but it could be valid at a future time. Remain connected to the client, keep and attempt to process the TxPoW but do not send it on to peers.",(0,i.jsx)("br",{}),"\r\n",(0,i.jsx)(n.strong,{children:"Outcome 3:"})," The TxPoW is fully valid - remain connected to the client, keep and attempt to process the TxPoW but do not send it on to peers."]}),"\n",(0,i.jsx)(n.p,{children:"Validating a TxPoW unit includes checking:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Does it already exist in the TxPoW database? ",(0,i.jsx)("br",{}),"\r\n",(0,i.jsx)(n.em,{children:"- if false, request it from the peer"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Does it  have a block number before the root of the TxPoW Tree? ",(0,i.jsx)("br",{}),"\r\n",(0,i.jsxs)(n.em,{children:["- if true, outcome 1. ",(0,i.jsx)("br",{})," - Reason:  this TxPoW is before the Cascade tip"]})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Is the block difficulty at most 10% below the tip block?",(0,i.jsx)("br",{}),"\r\n",(0,i.jsxs)(n.em,{children:["- if false, outcome 1. ",(0,i.jsx)("br",{})," - Reason:  the block difficulty is too low"]})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Does the Chain ID match the Chain ID of the current network? ",(0,i.jsx)("br",{}),"\r\n",(0,i.jsxs)(n.em,{children:["- if false, outcome 1. ",(0,i.jsx)("br",{})," - Reason:  the Chain ID is wrong"]})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Does it meet basic transaction checks?",(0,i.jsx)("br",{}),"\r\n",(0,i.jsxs)(n.em,{children:["- if false, outcome 1. ",(0,i.jsx)("br",{})," - Reason:  the TxPoW fails basic checks (see Basic TxPoW Checks)"]})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Are the signatures valid?",(0,i.jsx)("br",{}),"\r\n",(0,i.jsxs)(n.em,{children:["- if false, outcome 1. ",(0,i.jsx)("br",{})," - Reason: the signatures are invalid"]})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Are the coin and token scripts valid?",(0,i.jsx)("br",{}),"\r\n",(0,i.jsxs)(n.em,{children:["- if false & if the transaction is monotonic, outcome 1 but remain connected. ",(0,i.jsx)("br",{})," - Reason: monotonic TxPoWs will always be invalid if they fail script checks"]}),(0,i.jsx)("br",{}),(0,i.jsx)("br",{}),"\r\n",(0,i.jsxs)(n.em,{children:["- if false & if the transaction is non-monotonic, outcome 2. ",(0,i.jsx)("br",{})," - Reason: non-monotonic transactions are not fully valid at this point in time but are still processed in case they rely on a certain block time to be valid"]})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["If the TxPoW is a block, does it have a timestamp less than 2 hours in the future?",(0,i.jsx)("br",{}),"\r\n",(0,i.jsxs)(n.em,{children:["- if false, outcome 2. ",(0,i.jsx)("br",{})," - Reason: the TxPoW is over 2 hours in the future but not discarded as could be something wrong with internal clock"]})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Does it use any coins as transaction inputs that are also currently in the mempool?",(0,i.jsx)("br",{}),"\r\n",(0,i.jsxs)(n.em,{children:["- if true, outcome 2. ",(0,i.jsx)("br",{})," - Reason: the same coins are used in another transaction but the TxPoW is not discarded as it could be valid in another branch"]})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Do the CoinProofs for the main and burn transactions pass the MMR checks?",(0,i.jsx)("br",{}),"\r\n",(0,i.jsxs)(n.em,{children:["- if false, outcome 2. ",(0,i.jsx)("br",{})," - Reason: MMR proofs are not valid, but the TxPoW is not discarded as they could be valid in another branch"]})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Did it take longer than 1 second to process?",(0,i.jsx)("br",{}),"\r\n",(0,i.jsxs)(n.em,{children:["- if true, outcome 2. ",(0,i.jsx)("br",{})," - Reason: the message took a long time to process"]})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Fully Valid and not Fully Valid TxPoWs are then added to the TxPoW database. Only a Fully Valid TxPoW is then forwarded onto the node\u2019s peers.",(0,i.jsx)("br",{}),"\r\nIf a received TxPoW unit is a block, all the mempool TxPoW in the block\u2019s ",(0,i.jsx)(n.em,{children:"txn list"})," as well as the parent block must exist in the TxPoW database before it can be added to the TxPoW Tree. If the node is missing any, these are requested from peer nodes before processing."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Basic TxPoW checks:"}),(0,i.jsx)("br",{}),"\r\nThe Basic TxPoW checks ensure the main transaction and its burn transaction are valid."]}),"\n",(0,i.jsx)(n.p,{children:"The basic checks are:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"The Chain ID must be valid"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"For main transaction and burn transaction:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"The Link Hash connecting the main and burn transaction must be valid"}),"\n",(0,i.jsx)(n.li,{children:"Check if the transaction is empty, empty transactions are valid (e.g. a Pulse TxPoW)"}),"\n",(0,i.jsx)(n.li,{children:"Transaction inputs & outputs are valid"}),"\n",(0,i.jsx)(n.li,{children:"Must be at least one input"}),"\n",(0,i.jsx)(n.li,{children:"The number of MMR proofs must be correct"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"For all coins in the main transaction:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"No coins can be used more than once"}),"\n",(0,i.jsx)(n.li,{children:"If a custom token is being spent, the Token ID must match the Token ID in the coin and in the MMR Proof"}),"\n",(0,i.jsx)(n.li,{children:"CoinProof details must match the Coin details (amount, address & Token ID)"}),"\n",(0,i.jsx)(n.li,{children:"The Coin ID of non-floating coins must match the Coin ID in the CoinProof"}),"\n",(0,i.jsx)(n.li,{children:"The Coin must not be spent"}),"\n",(0,i.jsx)(n.li,{children:"The Coin must have script proofs"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"processing-txpow--assembling-the-chain",children:"Processing TxPoW & Assembling the Chain"}),"\n",(0,i.jsx)(n.p,{children:"The final step, once a TxPoW passes all the validation checks, is to push it to the end of a process stack so that it can be added to the TxPoW tree in the correct order."}),"\n",(0,i.jsx)(n.p,{children:"The node will process the stack, attempting to add any TxPoW units that are blocks to the end of the chain.\r\nA block\u2019s parent must exist in the tree before it can be added. If the parent does not exist in the tree yet, the node may not have had all its transactions when it first attempted to process it. Since last attempting to process the parent, the node should have received any missing transactions from its peers so it is searched for in the TxPoW database and, if found, added to the process stack to be processed before the child."}),"\n",(0,i.jsxs)(n.p,{children:["If the parent block is already in the tree, the TxPoW is processed by first ensuring that all mempool transactions in the ",(0,i.jsx)(n.em,{children:"txn list"})," of the TxPoW body exist in the user\u2019s TxPoW database. ",(0,i.jsx)("br",{})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["If there are any missing, the TxPoW cannot be processed any further. ",(0,i.jsx)("br",{})]}),"\n",(0,i.jsxs)(n.li,{children:["If there are none missing, the TxPoW will go through final checks before becoming a TxBlock. ",(0,i.jsx)("br",{})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["A ",(0,i.jsx)(n.strong,{children:"TxBlock"})," includes the TxPoW and adds the MMR peaks; a list of CoinProofs for all the coins that will become spent; and a list of the new coins that will be created from all the transactions in the block. ",(0,i.jsx)(n.a,{href:"/docs/learn/minima/txpowunits#txblocks-blocks",children:"(see TxBlocks)"})]}),"\n",(0,i.jsxs)(n.p,{children:["Once the TxBlock has been created, a structure is required to attach the block to the TxPoW tree, this is the role of a TxPoW Tree Node. It adds further relevant information to the TxBlock i.e. the MMR set; a list of all the spent and newly created coins; and a list of all the MMR entry numbers of any coins in any of the transactions that are relevant to the user (i.e. coins they are tracking). ",(0,i.jsx)(n.a,{href:"/docs/learn/minima/theblockchain#txpow-tree-node",children:"(see TxPoW Tree Nodes)"})]}),"\n",(0,i.jsxs)(n.p,{children:["A child node is then added to its parent in the tree and the tree is ",(0,i.jsx)(n.strong,{children:"recalculated"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Recalculating"})," the tree involves:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Calculating the weight of all blocks in the tree"}),"\n",(0,i.jsxs)(n.li,{children:["Selecting the heaviest branch as the main chain ",(0,i.jsx)(n.a,{href:"/docs/learn/minima/miningconsensus#selecting-the-main-chain-ghost",children:"(see Selecting the main chain)"})]}),"\n",(0,i.jsxs)(n.li,{children:["Cascading the chain if the heaviest branch has reached the required length ",(0,i.jsx)(n.a,{href:"/docs/learn/minima/theblockchain#attribute-5",children:"(see Cascading Chain - Attribute 5)"})]}),"\n",(0,i.jsx)(n.li,{children:"Setting transactions in the main chain so they cannot be added to a new TxPoW"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"The TxPoW database is then checked to see if there are any children for this new block as these can then be added to the process stack for processing."}),"\n",(0,i.jsx)(n.p,{children:"This process continues until either the process stack is empty or contains TxPoWs with transactions not yet received by the user."}),"\n",(0,i.jsx)(n.h2,{id:"selecting-the-main-chain-ghost",children:"Selecting the main chain (GHOST)"}),"\n",(0,i.jsx)(n.p,{children:"The TxPoW Tree consists of a main chain and branches which occur naturally due to network latency. All nodes in the network must only consider one chain to be the valid one at any point in time - the main chain. The tip of the main chain becomes the parent block that a node will attempt to build on when generating a TxPoW unit."}),"\n",(0,i.jsxs)(n.p,{children:["Minima uses the ",(0,i.jsx)(n.strong,{children:"GHOST (Greedy Heaviest Observed SubTree)"})," protocol to ensure that nodes can come to consensus on which chain to use as the main chain. GHOST dictates that the \u2018heaviest\u2019 branch should be the main chain. The \u2018heaviest\u2019 branch is the branch which has had the most Proof-of-Work put into it and may not necessarily be the longest chain."]}),"\n",(0,i.jsx)(n.p,{children:"An alternative to GHOST is the simple \u2018Longest chain\u2019 rule, where the valid chain is considered the one with the most number of blocks in it, however by using GHOST and considering the \u2018weight\u2019 of blocks rather than simply the number of blocks, the chain is more resilient to attack and allows for faster block times."}),"\n",(0,i.jsxs)(n.p,{children:["The weight of a block is equal to the sum of the base weights of its children, where the base weight = the block difficulty ",(0,i.jsx)(n.a,{href:"/docs/learn/minima/miningconsensus#difficulty",children:"(see Difficulty)"}),", so where there are siblings in the tree that create two branches, their parent block will have a total weight of the sum of the siblings."]}),"\n",(0,i.jsx)(n.p,{children:"The process of selecting the main chain (i.e. recalculating the tree) occurs after receiving and processing a TxPoW unit (whether or not it is a block). During this process, the weight of all blocks in the TxPoW tree (main chain and branches) are evaluated and the heaviest branch is set as the main chain. All transactions in the blocks of this chain are then considered as \u2018truth\u2019 and the node continues to build from the tip of this chain. This may mean some transactions are returned to the mempool and must be added to a new TxPoW unit before being confirmed."}),"\n",(0,i.jsxs)(n.p,{children:["Diagram illustrating the main chain according to GHOST. ",(0,i.jsx)("br",{}),"\r\nThe longest chain could more easily be achieved by an attacker in secret, however with the majority of the network constructing on the heaviest chain, the attacker's secret chain would not change the main chain."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Cascading Chain & TxPoW Tree showing main chain according to GHOST (with Block numbers)"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{alt:"Mining and Consensus",src:t(2040).Z+"#gh-light-mode-only",width:"1499",height:"679"}),(0,i.jsx)(n.img,{alt:"Mining and Consensus",src:t(1628).Z+"#gh-dark-mode-only",width:"1499",height:"679"})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Cascading Chain & TxPoW Tree showing main chain according to GHOST (with Block weight = 1)"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{alt:"Mining and Consensus",src:t(3242).Z+"#gh-light-mode-only",width:"1499",height:"679"}),(0,i.jsx)(n.img,{alt:"Mining and Consensus",src:t(318).Z+"#gh-dark-mode-only",width:"1499",height:"679"})]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["A block weight of 1 is for illustrative purposes only, actual block weights vary depending on the block difficulty of the network. ",(0,i.jsx)(n.a,{href:"/docs/learn/minima/miningconsensus#block-weight",children:"(see Block Weight)"})]})}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["GHOST was originally proposed as an alternative to Longest Chain by Sompolinsky and Zohar in the paper ",(0,i.jsx)(n.em,{children:"Secure High-Rate Transaction Processing in Bitcoin."})]})})]})}function d(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},3884:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/difficultyDm-959f10f2bbdb7b9494a0472ecf710e85.svg"},5278:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/difficultyLm-1d0a7a2de70327621ad99746e632d695.svg"},1628:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/miningConsensus1Dm-abb16a4445cb7e8cf6788648b0344b0d.svg"},2040:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/miningConsensus1Lm-d41254b8f33d4cccd1f8fd221b80b29e.svg"},318:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/miningConsensus2Dm-ccc735cf4b90afd5bb0a300a82c08317.svg"},3242:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/miningConsensus2Lm-edaa4f8dad9a037643bb85f4d90b1d7e.svg"},1151:(e,n,t)=>{t.d(n,{Z:()=>a,a:()=>r});var i=t(7294);const s={},o=i.createContext(s);function r(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);